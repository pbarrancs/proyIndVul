---
title: "EDA index covid"
output:
  html_document:
    df_print: paged
  html_notebook: default
  pdf_document: default
---
```{r setup, include=FALSE, results=FALSE}
#Instalar las librerias necesarias y cargarlas
instalar <- function(paquete) {
    if (!require(paquete,character.only = TRUE,
                 quietly = TRUE, 
                 warn.conflicts = FALSE)){
          install.packages(as.character(paquete),
                           dependecies = TRUE,
                           repos = "http://cran.us.r-project.org")
          library(paquete,
                  character.only = TRUE, 
                  quietly = TRUE,
                  warn.conflicts = FALSE)
    }
}
libs <- c('GGally', 'tidyverse', 'mctest', 'ggplot2', 'ggbeeswarm','dplyr', 'plotly') 
lapply(libs, instalar)
```

Realizaremos en análisis exploratorio de datos para conocer el comportamiento de nuestas variables.

Dividimos las variables que estaban en terminos poblacionales entre la población de cada delegación, pues en el análisis visual había indonsistencias (mostrama que entre más desempleo mayor remuneración).

```{r,echo = FALSE}
df<- read.csv("BD.csv")
df[,5:13]<-df[,5:13]/df[,3]
df[,13]<-df[,13]*1000
df.1<-df[,-c(1,3,4)]
```

¿Todas las variables aportan al índice? ¿Qué variables aportan más? ¿Qué variables aportan menos?

```{r,echo = FALSE}
ggcorr(df.1[-1], label = T)
```

```{r,echo=FALSE}
omcdiag(df.1[c(5,8,9,10,11,12,13)], df.1[1])
```

Notemos que las variables que menos se correlacionan con el resto son Remuneraciones, Personas afiliadas a servicio de salud, esperanza de vida, años promedio de escolaridad, personal médico y carencias de servicios. Probamos su no-colinearidad con el determinante de su varianza de correlaciones, el "Red indicator" y la suma de lambda inversa. Aunque no pasan otras tres pruebas, las anteriores son suficientes para el futuro PCA que se realizará.


```{r,echo=FALSE}
df.2<- cbind(df[1],df.1[c(5,8,9,10,11,12,13)])
```

Así que las variables que más aportan son las siete antes mencionadas.

Al ver que muchas de estas variables no aprotaran variabilidad a nuestro indice, decidimos categorizar las variables para obtener visualizaciones que nos ayuden mas.

```{r,echo=FALSE,include = FALSE}
categcolum <- function(daf,col,names)
{
  v <- as.numeric(scale(daf[,col]))
  n <- length(names)
  dim <- length(v)
  part <- 1/n
  r <- c()
  for (i in 1:dim)
  {
    if(v[i] <= -1)
      r[i] <- names[1]
    else
      if(v[i] <= 1)
      r[i] <- names[2]
      else
        r[i] <- names[3]
  }
  return(r)
}
```

```{r,echo = FALSE}
#Construccion de df.3, es decir df.2 + varibles categoricas
Desem <- categcolum(df,9,c("Bajo","Mediano","Alto"))
#P_Medico <- categcolum(df,11,c("Bajo","Mediano","Alto"))
df.3 <- cbind(df.2,Desem)
```

```{r}
df.3 %>% ggpairs(columns = c(2:8),upper = list(continuous = wrap('cor',size = 2)),  mapping = aes(color = Desem))
```

Veamos cómo se comportan los datos.

¿Qué grupo de desempleo tiene la remuneración más baja?

Realizamos una gráfica de brazos y caja para conocer la distribución de las remuneraciones para cada nivel de desempleo. Encontramos outliers solo para la categoría de desempleo medio y, cómo era de esperarse, la media más baja de remuneraciones es para la categoría de desempleo alto. 

```{r,echo=FALSE}
p <- ggplot(df.3, aes(x=Desem, y=Remuneracion)) + 
  geom_boxplot() 
p+ theme(axis.text.x = element_text(angle = 90))
```

¿Qué grupo de desempleo tiene más varianza en la esperanza de vida?
Ahora queremos ver las observaciones de esperanza de vida para cada grupo de desempleados. Encontramos que la CDMX es una región dónde la mayoría de las delegaciones tienen desempleo medio y a su vez la esperanza de vida más variada.
```{r}
ggplot(df.3,aes(Desem, esp_vida)) + geom_quasirandom()
```
 
¿Es el desempleo importante para determinar la esperanza de vida? Parace que no hay una correlación
```{r}
library(dplyr)
ggplot(df, aes(x=Desem, y=esp_vida, size = Pob, col=Alc)) +
    geom_point(alpha=0.7)
```


¿Y la remuneración? No hay relación
```{r}
ggplot(df, aes(x=Remuneracion, y=esp_vida, size = Pob, col=Alc)) +
    geom_point(alpha=0.7)
```

¿Están relacionadas las carencias? Parece que solo als alimenticias y las de salud, peor no las de servicios.
```{r}
plot_ly(x=df$C_alim, y=df$C_sal, z=df$C_ser, type="scatter3d", mode="markers", color=df$C_alim)
```





